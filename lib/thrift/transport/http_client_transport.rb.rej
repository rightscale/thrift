***************
*** 42,52 ****
  
      def flush
        http = Net::HTTP.new @url.host, @url.port
-       http.use_ssl = @url.scheme == "https"
        resp = http.post(@url.request_uri, @outbuf, @headers)
        data = resp.body
        @inbuf = StringIO.new data
-       @outbuf = ""
      end
    end
  end
--- 42,53 ----
  
      def flush
        http = Net::HTTP.new @url.host, @url.port
+       http.use_ssl = @url.scheme == 'https'
        resp = http.post(@url.request_uri, @outbuf, @headers)
        data = resp.body
+       data = Bytes.force_binary_encoding(data)
        @inbuf = StringIO.new data
+       @outbuf = Bytes.empty_byte_buffer
      end
    end
  end
